<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gci.schedule.driverless.mapper.ScheduleParamsAnchorMapper">
  <resultMap id="BaseResultMap" type="com.gci.schedule.driverless.bean.scheduleD.ScheduleParamsAnchor">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 22 13:58:59 CST 2019.
    -->
    <result column="ROUTE_ID" jdbcType="DECIMAL" property="routeId" />
    <result column="DIRECTION" jdbcType="VARCHAR" property="direction" />
    <result column="BEGIN_TIME" jdbcType="VARCHAR" property="beginTime" />
    <result column="END_TIME" jdbcType="VARCHAR" property="endTime" />
    <result column="ANCHOR_DURATION_MIN" jdbcType="DECIMAL" property="anchorDurationMin" />
    <result column="ANCHOR_DURATION_MAX" jdbcType="DECIMAL" property="anchorDurationMax" />
    <result column="BUS_OCCUPANCY" jdbcType="DECIMAL" property="busOccupancy" />
    <result column="PEAK_TYPE" jdbcType="VARCHAR" property="peakType" />
    <result column="BEGIN_TIME_DATE" jdbcType="TIMESTAMP" property="beginTimeDate" />
    <result column="END_TIME_DATE" jdbcType="TIMESTAMP" property="endTimeDate" />
  </resultMap>

  <resultMap id="AllResultMap" type="com.gci.schedule.driverless.bean.scheduleD.ScheduleParamsAnchor">
    <result column="ROUTE_ID" jdbcType="DECIMAL" property="routeId" />
    <result column="TEMPLATE_ID" jdbcType="DECIMAL" property="templateId" />
    <result column="DIRECTION" jdbcType="VARCHAR" property="direction" />
    <result column="BEGIN_TIME" jdbcType="VARCHAR" property="beginTime" />
    <result column="END_TIME" jdbcType="VARCHAR" property="endTime" />
    <result column="ANCHOR_DURATION_MIN" jdbcType="DECIMAL" property="anchorDurationMin" />
    <result column="ANCHOR_DURATION_MAX" jdbcType="DECIMAL" property="anchorDurationMax" />
    <result column="BUS_OCCUPANCY" jdbcType="DECIMAL" property="busOccupancy" />
    <result column="PEAK_TYPE" jdbcType="VARCHAR" property="peakType" />
    <result column="BEGIN_TIME_DATE" jdbcType="TIMESTAMP" property="beginTimeDate" />
    <result column="END_TIME_DATE" jdbcType="TIMESTAMP" property="endTimeDate" />
  </resultMap>
    <update id="updateTopPeak">
      update BS_SCHEDULE_PARAMS_ANCHOR set ANCHOR_DURATION_MIN=#{peakAnchorDurationMin},ANCHOR_DURATION_MAX=#{peakAnchorDurationMax},BUS_OCCUPANCY=#{peakBusOccupancy},UPDATE_USER=#{updateUser},UPDATE_TIME=sysdate
      where TEMPLATE_ID=#{templateId} and PEAK_TYPE in (1,2)
    </update>

  <update id="updateNormalPeak">
      update BS_SCHEDULE_PARAMS_ANCHOR set ANCHOR_DURATION_MIN=#{normalAnchorDurationMin},ANCHOR_DURATION_MAX=#{normalAnchorDurationMax},BUS_OCCUPANCY=#{normalBusOccupancy},UPDATE_USER=#{updateUser},UPDATE_TIME=sysdate
      where TEMPLATE_ID=#{templateId} and PEAK_TYPE = 3
    </update>

    <select id="selectList" resultMap="AllResultMap">
    select t.*
    from BS_SCHEDULE_PARAMS_ANCHOR t
  </select>

  <select id="selectByRouteId" resultMap="AllResultMap">
    select t.*
    from BS_SCHEDULE_PARAMS_ANCHOR t where t.route_id = #{routeId,jdbcType=DECIMAL}
  </select>

  <select id="getByTemplateId" resultMap="BaseResultMap"  parameterType="map">
    select * from BS_SCHEDULE_PARAMS_ANCHOR where    template_id = #{templateId, jdbcType=VARCHAR} order by direction ,begin_time
  </select>

  <delete id="delByTemplateId">
    delete from BS_SCHEDULE_PARAMS_ANCHOR where   template_id = #{templateId, jdbcType=VARCHAR}
  </delete>

  <insert id="insert" parameterType="map">
    insert into BS_SCHEDULE_PARAMS_ANCHOR (ROUTE_ID, DIRECTION, BEGIN_TIME,
    END_TIME, ANCHOR_DURATION_MIN, ANCHOR_DURATION_MAX,BUS_OCCUPANCY,PEAK_TYPE
    ,template_id ,update_user,update_time)
    values (#{routeId,jdbcType=DECIMAL}, #{direction,jdbcType=VARCHAR}, #{beginTime,jdbcType=VARCHAR},
    #{endTime,jdbcType=VARCHAR}, #{anchorDurationMin,jdbcType=DECIMAL}, #{anchorDurationMax,jdbcType=DECIMAL}, #{busOccupancy,jdbcType=DECIMAL}, #{peakType,jdbcType=VARCHAR},#{templateId} ,#{updateUser} ,sysdate)
  </insert>

  <select id="queryByRoute" resultMap="BaseResultMap">
    select t.*,to_date(to_char(#{runDate,jdbcType=TIMESTAMP},'yyyymmdd')||t.begin_time,'yyyymmddhh24mi') begin_time_date,
    to_date(to_char(#{runDate,jdbcType=TIMESTAMP},'yyyymmdd')||t.end_time,'yyyymmddhh24mi') end_time_date
    from BS_SCHEDULE_PARAMS_ANCHOR T
    where t.route_id = #{routeId,jdbcType=DECIMAL}
  </select>

  <insert id="insertByTemplate" parameterType="java.util.Map" >
    insert into  bs_schedule_params_anchor a2 (a2.route_id,a2.direction,a2.begin_time,a2.end_time, a2.anchor_duration_min, a2.anchor_duration_max
    , a2.bus_occupancy,a2.peak_type ,a2.template_id ,a2.update_user,a2.update_time)
      (select route_id2,t.direction,t.begin_time,t.end_time, t.anchor_duration_min, t.anchor_duration_max, t.bus_occupancy,t.peak_type
      ,#{templateId} ,#{updateUser} ,sysdate
       from
       (select #{routeId} as route_id2,a.direction,a.begin_time,a.end_time, a.anchor_duration_min, a.anchor_duration_max, a.bus_occupancy,a.peak_type

       from  bs_schedule_params_anchor  a
       where a.route_id =0
       <if test="direction != null">
         and a.direction = #{direction}
       </if>
       ) t)

  </insert>

  <insert id="insetObject">
    insert into BS_SCHEDULE_PARAMS_ANCHOR (ROUTE_ID, DIRECTION, BEGIN_TIME,
    END_TIME, ANCHOR_DURATION_MIN, ANCHOR_DURATION_MAX,BUS_OCCUPANCY,PEAK_TYPE
    ,template_id ,update_user,update_time)
    values (#{routeId}, #{direction}, #{beginTime},
    #{endTime}, #{anchorDurationMin}, #{anchorDurationMax}, #{busOccupancy}, #{peakType},#{templateId} ,#{updateUser} ,sysdate)
  </insert>

  <select id="getAllRouteId" resultType="java.util.HashMap">
     select route_id from BS_SCHEDULE_PARAMS_ANCHOR t group by route_id
  </select>

  <select id="getInitAnchorData" resultMap="BaseResultMap">
    select * from BS_SCHEDULE_PARAMS_ANCHOR where route_id=0
  </select>
</mapper>