<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gci.schedule.driverless.dynamic.mapper.BusNumberConfigDynamicMapper">
    <resultMap id="BaseResultMap" type="com.gci.schedule.driverless.dynamic.bean.BusNumberConfig">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Oct 29 10:24:25 CST 2019.
        -->
        <result column="ROUTE_ID" jdbcType="DECIMAL" property="routeId"/>
        <result column="ROUTE_CODE" jdbcType="VARCHAR" property="routeCode"/>
        <result column="PLAN_DATE" jdbcType="TIMESTAMP" property="planDate"/>
        <result column="BUS_NUMBER_OPTIMAL" jdbcType="DECIMAL" property="busNumberOptimal"/>
        <result column="SINGLE_BUS_NUMBER_OPTIMAL" jdbcType="DECIMAL" property="singleBusNumberOptimal"/>
        <result column="BUS_NUMBER_PRESET" jdbcType="DECIMAL" property="busNumberPreset"/>
        <result column="SINGLE_BUS_NUMBER_PRESET" jdbcType="DECIMAL" property="singleBusNumberPreset"/>
        <result column="UP_FIRST_BUS_NUMBER_OPTIMAL" jdbcType="DECIMAL" property="upFirstBusNumberOptimal"/>
        <result column="DOWN_FIRST_BUS_NUMBER_OPTIMAL" jdbcType="DECIMAL" property="downFirstBusNumberOptimal"/>
        <result column="UP_FIRST_BUS_NUMBER_PRESET" jdbcType="DECIMAL" property="upFirstBusNumberPreset"/>
        <result column="DOWN_FIRST_BUS_NUMBER_PRESET" jdbcType="DECIMAL" property="downFirstBusNumberPreset"/>
        <result column="SINGLE_BUS_NUMBER_OPTIMAL_UP" jdbcType="DECIMAL" property="singleBusNumberOptimalUp"/>
        <result column="SINGLE_BUS_NUMBER_OPTIMAL_DOWN" jdbcType="DECIMAL" property="singleBusNumberOptimalDown"/>
        <result column="SINGLE_BUS_NUMBER_PRESET_UP" jdbcType="DECIMAL" property="singleBusNumberPresetUp"/>
        <result column="SINGLE_BUS_NUMBER_PRESET_DOWN" jdbcType="DECIMAL" property="singleBusNumberPresetDown"/>
        <result column="UPDATE_TIME" jdbcType="DATE" property="updateTime"/>
        <result column="UPDATE_TIME_OPTIMAL" jdbcType="DATE" property="updateTimeOptimal"/>
        <result column="UPDATE_TIME_PRESET" jdbcType="DATE" property="updateTimePreset"/>
        <result column="TEMPLATE_ID" jdbcType="DATE" property="templateId"/>
    </resultMap>

    <sql id="Base_Column_List">
        ROUTE_ID, ROUTE_CODE, PLAN_DATE, BUS_NUMBER_OPTIMAL, SINGLE_BUS_NUMBER_OPTIMAL, BUS_NUMBER_PRESET,
        SINGLE_BUS_NUMBER_PRESET, UP_FIRST_BUS_NUMBER_OPTIMAL, DOWN_FIRST_BUS_NUMBER_OPTIMAL,
        UP_FIRST_BUS_NUMBER_PRESET, DOWN_FIRST_BUS_NUMBER_PRESET,SINGLE_BUS_NUMBER_OPTIMAL_UP,SINGLE_BUS_NUMBER_OPTIMAL_DOWN,
        SINGLE_BUS_NUMBER_PRESET_UP,SINGLE_BUS_NUMBER_PRESET_DOWN,UPDATE_TIME,UPDATE_TIME_OPTIMAL,UPDATE_TIME_PRESET,TEMPLATE_ID
    </sql>

    <select id="selectByRouteIdAndPlanDate" parameterType="map" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from DY_BUS_NUMBER_CONFIG c
        where c.route_id = #{routeId,jdbcType=VARCHAR}
        and c.plan_date = #{planDate,jdbcType=TIMESTAMP}
    </select>

    <delete id="deleteByRouteIdAndPlanDate" parameterType="map">
        delete from DY_BUS_NUMBER_CONFIG c
        where c.route_id =  #{routeId,jdbcType=VARCHAR}
          and  c.plan_date = #{planDate,jdbcType=TIMESTAMP}

    </delete>

    <update id="save" parameterType="com.gci.schedule.driverless.dynamic.bean.BusNumberConfig">
        merge into dy_bus_number_config c
            using(select #{routeId,jdbcType=DECIMAL} route_id , #{routeCode,jdbcType=VARCHAR} route_code, trunc(#{planDate,jdbcType=TIMESTAMP}) plan_date,
                         #{busNumberOptimal,jdbcType=DECIMAL} bus_number_optimal , #{singleBusNumberOptimal,jdbcType=DECIMAL} single_bus_number_optimal,
                         #{busNumberPreset,jdbcType=DECIMAL} bus_number_preset , #{singleBusNumberPreset,jdbcType=DECIMAL} single_bus_number_preset,
                         #{upFirstBusNumberOptimal,jdbcType=DECIMAL} up_first_bus_number_optimal , #{downFirstBusNumberOptimal,jdbcType=DECIMAL} down_first_bus_number_optimal,
                         #{upFirstBusNumberPreset,jdbcType=DECIMAL} up_first_bus_number_preset, #{downFirstBusNumberPreset,jdbcType=DECIMAL} down_first_bus_number_preset,
                         #{singleBusNumberOptimalUp,jdbcType=DECIMAL} single_bus_number_optimal_up,#{singleBusNumberOptimalDown,jdbcType=DECIMAL} single_bus_number_optimal_down,
                         #{singleBusNumberPresetUp,jdbcType=DECIMAL} single_bus_number_preset_up,#{singleBusNumberPresetDown,jdbcType=DECIMAL} single_bus_number_preset_down,
                         #{updateTimeOptimal,jdbcType=TIMESTAMP} update_time_optimal,#{updateTimePreset,jdbcType=TIMESTAMP}
                             update_time_preset, #{templateId,jdbcType=DECIMAL} template_id
                  from  dual ) a
            on (c.route_id = a.route_id and c.plan_date = a.plan_date)
            when matched then
                update set
                    c.bus_number_optimal =  a.bus_number_optimal , c.single_bus_number_optimal =a.single_bus_number_optimal,
                    c.bus_number_preset = a.bus_number_preset , c.single_bus_number_preset = a.single_bus_number_preset,
                    c.up_first_bus_number_optimal =  a.up_first_bus_number_optimal, c.down_first_bus_number_optimal = a.down_first_bus_number_optimal ,
                    c.up_first_bus_number_preset = a.up_first_bus_number_preset, c.down_first_bus_number_preset = a.down_first_bus_number_preset,
                    c.single_bus_number_optimal_up=a.single_bus_number_optimal_up,c.single_bus_number_optimal_down=a.single_bus_number_optimal_down,
                    c.single_bus_number_preset_up=a.single_bus_number_preset_up,c.single_bus_number_preset_down=a.single_bus_number_preset_down,
                    c.update_time=sysdate,c.update_time_optimal=a.update_time_optimal,c.update_time_preset=a.update_time_preset,c.template_id=a.template_id
            when not matched then
                insert (c.route_id, c.route_code, c.plan_date,
                        c.bus_number_optimal, c.single_bus_number_optimal,
                        c.bus_number_preset, c.single_bus_number_preset,
                        c.up_first_bus_number_optimal, c.down_first_bus_number_optimal,
                        c.up_first_bus_number_preset, c.down_first_bus_number_preset,
                        c.single_bus_number_optimal_up,c.single_bus_number_optimal_down,
                        c.single_bus_number_preset_up,c.single_bus_number_preset_down,
                        c.update_time,c.update_time_optimal,c.update_time_preset,c.template_id)
                    values (a.route_id, a.route_code, a.plan_date,
                            a.bus_number_optimal, a.single_bus_number_optimal,
                            a.bus_number_preset, a.single_bus_number_preset,
                            a.up_first_bus_number_optimal, a.down_first_bus_number_optimal,
                            a.up_first_bus_number_preset, a.down_first_bus_number_preset,
                            a.single_bus_number_optimal_up,a.single_bus_number_optimal_down,
                            a.single_bus_number_preset_up,a.single_bus_number_preset_down,
                            sysdate,a.update_time_optimal,a.update_time_preset,a.template_id)
    </update>
</mapper>