<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gci.schedule.driverless.dynamic.mapper.SchedulePlanDynamicMapper">
    <resultMap id="BaseResultMap" type="com.gci.schedule.driverless.dynamic.bean.SchedulePlan">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Apr 23 17:23:41 CST 2019.
        -->
        <result column="SCHEDULE_ID" jdbcType="DECIMAL" property="scheduleId"/>
        <result column="ROUTE_ID" jdbcType="DECIMAL" property="routeId"/>
        <result column="ROUTE_CODE" jdbcType="VARCHAR" property="routeCode"/>
        <result column="PLAN_DATE" jdbcType="TIMESTAMP" property="planDate"/>
        <result column="PLAN_TIME" jdbcType="TIMESTAMP" property="planTime"/>
        <result column="START_DIRECTION" jdbcType="VARCHAR" property="startDirection"/>
        <result column="START_ORDER_NUMBER" jdbcType="DECIMAL" property="startOrderNumber"/>
        <result column="TRIP_END_TIME" jdbcType="TIMESTAMP" property="tripEndTime"/>
        <result column="SERVICE_TYPE" jdbcType="VARCHAR" property="serviceType"/>
        <result column="SERVICE_NAME" jdbcType="VARCHAR" property="serviceName"/>
        <result column="DIRECTION" jdbcType="VARCHAR" property="direction"/>
        <result column="BUS_CODE" jdbcType="VARCHAR" property="busCode"/>
        <result column="BUS_ID" jdbcType="BIGINT" property="busId"></result>
        <result column="BUS_NAME" jdbcType="BIGINT" property="busName"></result>
        <result column="BUS_NAME_Full" jdbcType="VARCHAR" property="busNameFull"/>
        <result column="FIRST_ROUTE_STA_ID" jdbcType="VARCHAR" property="firstRouteStaId"/>
        <result column="LAST_ROUTE_STA_ID" jdbcType="VARCHAR" property="lastRouteStaId"/>
    </resultMap>

    <delete id="delete">
        delete from DY_SCHEDULE_PLAN
        <where>
            <choose>
                <when test="routeId != null and runDate != null">
                    and route_id = #{routeId,jdbcType=DECIMAL}
                    and plan_date = #{runDate,jdbcType=TIMESTAMP}
                </when>
                <otherwise>
                    and 1=2
                </otherwise>
            </choose>
        </where>
    </delete>

    <select id="getSchedulePlanList" resultMap="BaseResultMap">
        select schedule_id
             , route_id
             , route_code
             , plan_date
             , plan_time
             , start_direction
             , start_order_number
             , trip_end_time
             , service_type
             , service_name
             , direction
             , bus_code
             , bus_id
             , bus_name
             , FIRST_ROUTE_STA_ID
             , LAST_ROUTE_STA_ID
        from Dy_Schedule_Plan p
        where P.route_id = #{routeId,jdbcType=DECIMAL}
          and p.plan_date = #{runDate,jdbcType=TIMESTAMP}
        order by p.start_direction, p.start_order_number, p.plan_time
    </select>

    <insert id="insert" parameterType="com.gci.schedule.driverless.dynamic.bean.SchedulePlan">
        insert into DY_SCHEDULE_PLAN (SCHEDULE_ID, ROUTE_ID, ROUTE_CODE,
                                      PLAN_DATE, PLAN_TIME, START_DIRECTION,
                                      START_ORDER_NUMBER, TRIP_END_TIME, SERVICE_TYPE,
                                      SERVICE_NAME, DIRECTION, BUS_CODE,
                                      FIRST_ROUTE_STA_ID, LAST_ROUTE_STA_ID, FIRST_ROUTE_STA_NAME, LAST_ROUTE_STA_NAME,
                                      RUN_MILEAGE, PEAK_TYPE, FIRST_ROUND_TASK_ID, FIRST_ROUND_PLAN_TIME)
        values (SEQ_SCHEDULE_PLAN_SCHEDULE_ID.NEXTVAL,
                #{routeId,jdbcType=DECIMAL}, #{routeCode,jdbcType=VARCHAR},
                #{planDate,jdbcType=TIMESTAMP}, #{planTime,jdbcType=TIMESTAMP}, #{startDirection,jdbcType=VARCHAR},
                #{startOrderNumber,jdbcType=DECIMAL}, #{tripEndTime,jdbcType=TIMESTAMP},
                #{serviceType,jdbcType=VARCHAR},
                #{serviceName,jdbcType=VARCHAR}, #{direction,jdbcType=VARCHAR}, #{busCode,jdbcType=VARCHAR},
                #{firstRouteStaId,jdbcType=DECIMAL}, #{lastRouteStaId,jdbcType=DECIMAL},
                #{firstRouteStaName,jdbcType=VARCHAR}, #{lastRouteStaName,jdbcType=VARCHAR},
                #{runMileage,jdbcType=DECIMAL}, #{peakType,jdbcType=VARCHAR}, #{firstRoundTaskId,jdbcType=DECIMAL},
                #{firstRoundPlanTime,jdbcType=TIMESTAMP})
    </insert>

    <delete id="deleteOptimal">
        delete from DY_SCHEDULE_PLAN_OPTIMAL
        <where>
            <choose>
                <when test="routeId != null and runDate != null">
                    and route_id = #{routeId,jdbcType=DECIMAL}
                    and plan_date = #{runDate,jdbcType=TIMESTAMP}
                </when>
                <otherwise>
                    and 1=2
                </otherwise>
            </choose>
        </where>
    </delete>

    <insert id="insertOptimal" parameterType="com.gci.schedule.driverless.dynamic.bean.SchedulePlan">
        insert into DY_SCHEDULE_PLAN_OPTIMAL (SCHEDULE_ID, ROUTE_ID, ROUTE_CODE,
                                              PLAN_DATE, PLAN_TIME, START_DIRECTION,
                                              START_ORDER_NUMBER, TRIP_END_TIME, SERVICE_TYPE,
                                              SERVICE_NAME, DIRECTION, BUS_CODE,
                                              FIRST_ROUTE_STA_ID, LAST_ROUTE_STA_ID, FIRST_ROUTE_STA_NAME,
                                              LAST_ROUTE_STA_NAME)
        values (SEQ_SCHEDULE_PLAN_SCHEDULE_ID.NEXTVAL,
                #{routeId,jdbcType=DECIMAL}, #{routeCode,jdbcType=VARCHAR},
                #{planDate,jdbcType=TIMESTAMP}, #{planTime,jdbcType=TIMESTAMP}, #{startDirection,jdbcType=VARCHAR},
                #{startOrderNumber,jdbcType=DECIMAL}, #{tripEndTime,jdbcType=TIMESTAMP},
                #{serviceType,jdbcType=VARCHAR},
                #{serviceName,jdbcType=VARCHAR}, #{direction,jdbcType=VARCHAR}, #{busCode,jdbcType=VARCHAR},
                #{firstRouteStaId,jdbcType=DECIMAL}, #{lastRouteStaId,jdbcType=DECIMAL},
                #{firstRouteStaName,jdbcType=VARCHAR}, #{lastRouteStaName,jdbcType=VARCHAR})
    </insert>

    <delete id="deleteOptimalTimetable">
        delete from DY_TIMETABLE_OPTIMAL
        <where>
            <choose>
                <when test="routeId != null and runDate != null">
                    and route_id = #{routeId,jdbcType=DECIMAL}
                    and plan_date = #{runDate,jdbcType=TIMESTAMP}
                </when>
                <otherwise>
                    and 1=2
                </otherwise>
            </choose>
        </where>
    </delete>

    <delete id="deleteSingleBusPlan">
        delete
        from DY_BUS_SINGLE
        where route_id = #{routeId,jdbcType=DECIMAL}
          and PLAN_DATE = #{runDate,jdbcType=TIMESTAMP}
    </delete>

    <insert id="saveSingleBusPlan" parameterType="com.gci.schedule.driverless.dynamic.bean.SingleBus">
        insert into dy_bus_single
        (route_id, route_code, plan_date, bus_id, bus_name, station_id_stop, middle_stop_time, off_duty_time,
         start_direction, start_order_number)
        values (#{routeId,jdbcType=DECIMAL}, #{routeCode,jdbcType=VARCHAR}, #{planDate,jdbcType=TIMESTAMP},
                #{busId,jdbcType=DECIMAL}, #{busName,jdbcType=VARCHAR}
                   , #{stationIdStop,jdbcType=DECIMAL}, #{middleStopTime,jdbcType=TIMESTAMP},
                #{offDutyTime,jdbcType=TIMESTAMP}, #{startDirection,jdbcType=DECIMAL},
                #{startOrderNumber,jdbcType=DECIMAL})
    </insert>
</mapper>